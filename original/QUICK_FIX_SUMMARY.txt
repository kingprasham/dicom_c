================================================================================
QUICK FIX - Production Image Loading Error (HTTP 500)
================================================================================

PROBLEM: Images won't load on https://e-connect.in/dicom/
ERROR: HTTP 500 on get_dicom_from_orthanc.php

ROOT CAUSE: Production uses API Gateway (ngrok), old PHP file only supports direct Orthanc

YOUR STATUS:
✓ main.js is already fixed and uploaded
✗ PHP proxy file is broken (needs API Gateway support)

--------------------------------------------------------------------------------
SOLUTION (3 Steps):
--------------------------------------------------------------------------------

1. UPLOAD FILE TO CPANEL
   ----------------------
   File: PRODUCTION_get_dicom_from_orthanc.php
   From: c:\xampp\htdocs\papa\dicom_again\PRODUCTION_get_dicom_from_orthanc.php
   To: /public_html/dicom/api/get_dicom_from_orthanc.php

   Steps:
   - Login cPanel: https://e-connect.in:2083/
   - File Manager → /public_html/dicom/api/
   - Backup old: rename get_dicom_from_orthanc.php to get_dicom_from_orthanc.php.old
   - Upload: PRODUCTION_get_dicom_from_orthanc.php
   - Rename: PRODUCTION_get_dicom_from_orthanc.php → get_dicom_from_orthanc.php


2. CHECK ERROR LOGS
   ----------------
   - cPanel → Errors (or Error Log)
   - Look for "DICOM Proxy Error:" messages
   - These will tell you exactly what's wrong


3. VERIFY CONFIG.PHP
   -----------------
   File: /public_html/dicom/config.php
   Must have:

   define('ORTHANC_URL', 'http://localhost:8042');
   define('ORTHANC_USER', 'orthanc');
   define('ORTHANC_PASS', 'orthanc');

   (Use your actual Orthanc URL, username, password)

--------------------------------------------------------------------------------
MOST COMMON ISSUES:
--------------------------------------------------------------------------------

□ config.php doesn't have ORTHANC_URL defined
  Fix: Add the Orthanc settings to config.php

□ Wrong Orthanc URL/credentials in config.php
  Fix: Update with correct values

□ cURL extension disabled in PHP
  Fix: cPanel → Software → Select PHP Version → Enable 'curl'

□ Orthanc server not running
  Fix: Start Orthanc service on server

□ File not uploaded to correct location
  Fix: Must be at /public_html/dicom/api/get_dicom_from_orthanc.php

--------------------------------------------------------------------------------
TEST AFTER UPLOADING:
--------------------------------------------------------------------------------

Direct test (in browser):
https://e-connect.in/dicom/api/get_dicom_from_orthanc.php?instanceId=47739cb2-3e5416ff-981ea238-36b30063-4722ce98

Expected: Downloads .dcm file or shows binary data
Error: Check PHP error logs for the reason

Full test:
https://e-connect.in/dicom/index.php?studyUID=d61c62d3-187bc863-f1ec4b5b-8b0b1069-38f4bc27&orthancId=d61c62d3-187bc863-f1ec4b5b-8b0b1069-38f4bc27

Expected: Images load and display
Console shows: "Image loaded successfully: 512 x 512"

--------------------------------------------------------------------------------
FILES SUMMARY:
--------------------------------------------------------------------------------

✓ main.js - ALREADY UPLOADED (you did this)
✗ get_dicom_from_orthanc.php - NEEDS UPLOAD (upload PRODUCTION version)
? load_study_fast.php - VERIFY has orthancInstanceId and isOrthancImage fields
? config.php - VERIFY has Orthanc settings

--------------------------------------------------------------------------------
DETAILED GUIDE:
--------------------------------------------------------------------------------

Read: FIX_PRODUCTION_500_ERROR.md
(Complete step-by-step troubleshooting guide)

================================================================================
